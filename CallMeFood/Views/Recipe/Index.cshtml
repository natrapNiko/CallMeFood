@using Microsoft.AspNetCore.Identity
@using CallMeFood.ViewModels;

@inject UserManager<CallMeFood.Data.Models.ApplicationUser> UserManager

@{
    var currentUserId = UserManager.GetUserId(User);
    var isAdmin = User.IsInRole("role-admin-id");
}

@model IEnumerable<RecipeViewModel>

@{
    ViewData["Title"] = "All Recipes";
}

<h2>@ViewData["Title"]</h2>

@if (!Model.Any())
{
    <div>No recipes found.</div>
}
else
{
    <div class="recipe-list">
        @foreach (var recipe in Model)
        {
            <div class="recipe-card" style="border:1px solid #ccc; border-radius:8px; padding:15px; margin-bottom:18px; max-width:480px;">
                <h3>@recipe.Title</h3>
                <p>@recipe.Description</p>
                <div>
                    <span><strong>Category:</strong> @recipe.CategoryName</span><br />
                    <span><strong>Author:</strong> @recipe.AuthorName</span><br />
                    <span><strong>Created:</strong> @recipe.CreatedOn.ToString("yyyy-MM-dd")</span>
                </div>
                @if (!string.IsNullOrWhiteSpace(recipe.ImageUrl))
                {
                    <div style="margin-top:10px;">
                        <img src="@recipe.ImageUrl" alt="Image for @recipe.Title" style="max-width:200px; max-height:140px;" />
                    </div>
                }
                <div style="margin-top:10px;">
                    <a href="@Url.Action("Details", "Recipe", new { id = recipe.Id })">View Details</a>

                    @* --- EDIT BUTTON: Only for Admin or Author --- видим ботон само за създатели и админ *@
                    @if (isAdmin || recipe.AuthorId == currentUserId)
                    {
                        <span> | </span>
                        <a href="@Url.Action("Edit", "Recipe", new { id = recipe.Id })">Edit</a>
                    }
                </div>
            </div>
        }
    </div>
}
